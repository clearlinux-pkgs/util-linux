Changes between v2.30.1 and v2.30.2
--------------------------------------------

commit 8bef60e497f769792af9b756dfb91f8696956db0
Author: Karel Zak <kzak@redhat.com>
Date:   Thu Sep 21 11:29:34 2017 +0200

    build-sys: release++ (v2.30.2)
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 NEWS         | 4 ++++
 configure.ac | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

commit ac9bb2ce028807ca416d530dc93b17c40e5732d2
Author: Karel Zak <kzak@redhat.com>
Date:   Thu Sep 21 11:27:50 2017 +0200

    docs: update v2.30.2-ReleaseNotes
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 Documentation/releases/v2.30.2-ReleaseNotes | 42 +++++++++++++++++++++++++++++
 1 file changed, 42 insertions(+)

commit 1a437733934a15c3210c4290795c3e7276aa7655
Author: Karel Zak <kzak@redhat.com>
Date:   Thu Sep 21 11:26:13 2017 +0200

    docs: update AUTHORS file
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 AUTHORS | 2 ++
 1 file changed, 2 insertions(+)

commit 005b1ee997e6523bddbe30391da33123f57847eb
Author: Karel Zak <kzak@redhat.com>
Date:   Thu Sep 21 11:24:57 2017 +0200

    po: merge changes
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 po/ca.po          |  456 ++++++++--------
 po/cs.po          | 1448 +++++++++++++++++++++++++-------------------------
 po/da.po          |  456 ++++++++--------
 po/de.po          |  456 ++++++++--------
 po/es.po          | 1448 +++++++++++++++++++++++++-------------------------
 po/et.po          |  456 ++++++++--------
 po/eu.po          |  456 ++++++++--------
 po/fi.po          |  456 ++++++++--------
 po/fr.po          | 1524 +++++++++++++++++++++++++----------------------------
 po/gl.po          |  456 ++++++++--------
 po/hr.po          |  456 ++++++++--------
 po/hu.po          |  456 ++++++++--------
 po/id.po          |  456 ++++++++--------
 po/it.po          |  456 ++++++++--------
 po/ja.po          |  456 ++++++++--------
 po/nl.po          |  456 ++++++++--------
 po/pl.po          |  456 ++++++++--------
 po/pt_BR.po       |  456 ++++++++--------
 po/ru.po          |  456 ++++++++--------
 po/sl.po          |  456 ++++++++--------
 po/sv.po          |  456 ++++++++--------
 po/tr.po          |  456 ++++++++--------
 po/uk.po          |  456 ++++++++--------
 po/util-linux.pot |  458 ++++++++--------
 po/vi.po          |  456 ++++++++--------
 po/zh_CN.po       |  456 ++++++++--------
 po/zh_TW.po       |  456 ++++++++--------
 27 files changed, 7663 insertions(+), 7703 deletions(-)

commit 29519c76d2888eb20a64cfeed1ba21ca4e1abc15
Author: Karel Zak <kzak@redhat.com>
Date:   Wed Sep 20 12:14:42 2017 +0200

    po: fix ipcrm translation error fr.po
    
    Addresses: https://github.com/karelzak/util-linux/issues/512
    Signed-off-by: Karel Zak <kzak@redhat.com>

 po/fr.po | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 9184834b61ec28e09259d78492be5a61e4263cdc
Author: Stéphane Aulery <lkppo@free.fr>
Date:   Thu Sep 21 11:12:29 2017 +0200

    po: update fr.po (from translationproject.org)

 po/fr.po | 1847 +++++++++++++++++++++++++++++++-------------------------------
 1 file changed, 913 insertions(+), 934 deletions(-)

commit 02dddc2e759c9216cabc1c3386514f1b98335363
Author: Antonio Ceballos Roa <aceballos@gmail.com>
Date:   Thu Sep 21 11:12:29 2017 +0200

    po: update es.po (from translationproject.org)

 po/es.po | 2094 +++++++++++++++++++++++++++++---------------------------------
 1 file changed, 986 insertions(+), 1108 deletions(-)

commit 4fc936fc8e1febd3561917a06363e1bfbbf12f34
Author: Petr Písař <petr.pisar@atlas.cz>
Date:   Thu Sep 21 11:12:29 2017 +0200

    po: update cs.po (from translationproject.org)

 po/cs.po | 2494 +++++++++++++++++++++++++++++---------------------------------
 1 file changed, 1173 insertions(+), 1321 deletions(-)

commit 8bd46ac512a81f77f3fbe08b8b849c698e4f6af1
Author: Karel Zak <kzak@redhat.com>
Date:   Fri Sep 15 13:30:40 2017 +0200

    swaplabel: fix --disable-libuuid compilation
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 disk-utils/swaplabel.c | 5 +++++
 1 file changed, 5 insertions(+)

commit ee4ee070a82c73ad4e5c11c6ddc06e0fb57c11e2
Author: Vaclav Dolezal <vdolezal@redhat.com>
Date:   Tue Aug 15 10:02:45 2017 +0200

    libfdisk: fix fdisk_reset_partition() leaking *_chs strings.
    
    Signed-off-by: Vaclav Dolezal <vdolezal@redhat.com>

 libfdisk/src/partition.c | 2 ++
 1 file changed, 2 insertions(+)

commit 8f4d17baa08dfe574a261be20884d20cd6547ae9
Author: Vaclav Dolezal <vdolezal@redhat.com>
Date:   Mon Aug 14 12:57:52 2017 +0200

    libfdisk: fix two potential memory errors.
    
    Fixes one leak and one unchecked allocation error.
    
    [kzak@redhat.com: - don't call fdisk_ask_menu_get_result()
                        after failed fdisk_do_ask()]
    
    Signed-off-by: Vaclav Dolezal <vdolezal@redhat.com>
    Signed-off-by: Karel Zak <kzak@redhat.com>

 libfdisk/src/dos.c | 5 +++--
 libfdisk/src/gpt.c | 2 ++
 2 files changed, 5 insertions(+), 2 deletions(-)

commit 7e99818e51bd25f79b9a676c960073a812854ccb
Author: Karel Zak <kzak@redhat.com>
Date:   Tue Aug 22 14:54:27 2017 +0200

    libfdisk: (dos) use size-=1 when alignment not used later
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 libfdisk/src/dos.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

commit a0dae7cf46810f6d0df7768653ed16ce2b3fbdf3
Author: Karel Zak <kzak@redhat.com>
Date:   Tue Aug 22 14:48:14 2017 +0200

    libfdisk: (gpt) fix size-1 error
    
    If partition does not require alignment, then don't call LBA align
    function and don't use size-=1 (fdisk_align_lba_in_range() returns
    unmodified size and we call size=-1 more than once for the same size).
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 libfdisk/src/gpt.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

commit 4436ff231bc3811920bff54162981c0fa889f26b
Author: Karel Zak <kzak@redhat.com>
Date:   Fri Aug 18 10:29:54 2017 +0200

    lslogins: be more explicit with -g in man page
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 login-utils/lslogins.1 | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

commit 9a982a5da99ce6eb8accf515e8d8972ced6e5dfb
Author: Karel Zak <kzak@redhat.com>
Date:   Fri Aug 18 10:23:38 2017 +0200

    lslogins: ignore non-existing users
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 login-utils/lslogins.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

commit b9ccf6fe72193f508e2a1f44ecfd369e0689bd84
Author: Karel Zak <kzak@redhat.com>
Date:   Wed Aug 16 14:15:56 2017 +0200

    dmesg: fix delimiter calculation
    
    Reported-by: Laszlo Varkonyi <vlsoftsystems@gmail.com>
    Signed-off-by: Karel Zak <kzak@redhat.com>

 sys-utils/dmesg.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit c712bf87341b02a1cac5274e57728f9c32133983
Author: Karel Zak <kzak@redhat.com>
Date:   Wed Aug 16 11:55:57 2017 +0200

    libblkid: fix compiler warning [-Wformat-truncation=]
    
    The MBR partition pseudo-UUID is generated from table ID and partition
    partno. The final UUID size limit is 37 bytes. The table ID has to be
    restricted to keep compiler happy (for MBR the table ID is 8 bytes
    as string).
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 libblkid/src/partitions/partitions.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit bb3f968f2fd67207d0997625bd01fe3ea5f43e22
Author: Karel Zak <kzak@redhat.com>
Date:   Tue Aug 15 14:03:43 2017 +0200

    cfdisk: add missing 0x7F key mapping
    
    Addresses: https://github.com/karelzak/util-linux/issues/499
    Signed-off-by: Karel Zak <kzak@redhat.com>

 disk-utils/cfdisk.c | 1 +
 1 file changed, 1 insertion(+)

commit ed8070a14daeb3175ea60b29a872a955ec61dbdd
Author: Karel Zak <kzak@redhat.com>
Date:   Mon Aug 14 11:30:37 2017 +0200

    blockdev: document --setro more properly
    
    Addresses: https://github.com/karelzak/util-linux/issues/498
    Signed-off-by: Karel Zak <kzak@redhat.com>

 disk-utils/blockdev.8 | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

commit c73ef5e8ba43b9b7b45a9fd87d65eb641a8343a2
Author: Karel Zak <kzak@redhat.com>
Date:   Mon Aug 14 10:56:08 2017 +0200

    lib/randutils: reset lose counter
    
    It's probaly good idea to reset lose counter when we fallback from
    getrandom() to /dev/urandom.
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 lib/randutils.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit fa949792072530b49ef5760d7ecd6d250c66e35f
Author: Karel Zak <kzak@redhat.com>
Date:   Mon Aug 14 10:33:06 2017 +0200

    lib/randutils: improve getrandom() usage
    
    The getrandom() does not have to return all requested bytes (missing
    entropy or when interrupted by signal). The current implementation in
    util-linux stupidly asks for all random data again, rather than only
    for missing bytes.
    
    The current code also does not care if we repeat our requests for
    ever; that's bad.
    
    This patch uses the same way as we already use for reading from
    /dev/urandom. It means:
    
     * repeat getrandom() for only missing bytes
     * limit number of unsuccessful request (16 times)
     * fallback to /dev/urandom on ENOSYS (old kernel or so...)
    
    Addresses: https://github.com/karelzak/util-linux/issues/496
    Signed-off-by: Karel Zak <kzak@redhat.com>

 lib/randutils.c | 64 +++++++++++++++++++++++++++++++++++++++++----------------
 1 file changed, 46 insertions(+), 18 deletions(-)

commit 0e10ad091968dd9277274353fb6353f52fffe89e
Author: Christopher James Halse Rogers <raof@ubuntu.com>
Date:   Mon Aug 7 16:10:51 2017 +1000

    lib/randutils.c: More paranoia in getrandom() call.
    
    If getrandom() is called with nbytes ≥ 256 then it can return with less than the requested
    bytes filled.
    
    In this case we *could* adjust the buffer by the number of bytes actually read, but it's
    simpler to just redo the call.

 lib/randutils.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit 861f274862105cd30d4442fb63e24af0d2e57e66
Author: Christopher James Halse Rogers <raof@ubuntu.com>
Date:   Mon Aug 7 16:07:54 2017 +1000

    lib/randutils.c: Fall back gracefully when kernel doesn't support getrandom(2).
    
    The 3.16 kernel is supported until 2020, and various distros have kernels of the same
    vintage. It's entirely possible for code built against newer headers to be run against
    these kernels, so fall-back to the old “read /dev/{u,}random” method if the kernel doesn'
    support getrandom()

 lib/randutils.c | 44 ++++++++++++++++++++++++++------------------
 1 file changed, 26 insertions(+), 18 deletions(-)

commit 1279d6881d77982a13cb1e9a63c31dd6a37ad545
Author: Andreas Henriksson <andreas@fatal.se>
Date:   Thu Jul 27 23:00:15 2017 +0200

    fstab(5): mention how tabs are escaped
    
    Someone requested explicitly mentioning how tabs are escaped,
    in addition to the already existing spaces example.
    
    Addresses: https://bugs.debian.org/580047
    Signed-off-by: Andreas Henriksson <andreas@fatal.se>

 sys-utils/fstab.5 | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

commit 0b526bec22c86b2151d7fea955874b6e58b5a647
Author: Sami Kerola <kerolasa@iki.fi>
Date:   Sun Jul 23 22:20:37 2017 +0100

    wdctl: do not call fsync(2) when closing watchdog device
    
    This removes bogus write failed warning.
    
    $ wdctl
    wdctl: write failed: Invalid argument
    Device:        /dev/watchdog
    [...]
    
    Signed-off-by: Sami Kerola <kerolasa@iki.fi>

 sys-utils/wdctl.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

commit ff70a9c216fe63a2bf318079b3d207c16aa9b575
Author: Karel Zak <kzak@redhat.com>
Date:   Tue Jul 11 12:17:40 2017 +0200

    libblkid: don't check for size on UBI (char dev)
    
    Signed-off-by: Karel Zak <kzak@redhat.com>

 libblkid/src/probe.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

commit f94343b04417c7353fc83162ded66d1f28ef5f0d
Author: Karel Zak <kzak@redhat.com>
Date:   Tue Jul 4 12:50:39 2017 +0200

    login: use IPv4 on IPv4-mapping-to-IPv6
    
    It seems that on some systems (e.g. RHEL7) the libc function
    getaddrinfo() is not able to translate ::ffff: address to IPv4. The
    result is 0.0.0.0 host address in the last(1) and utmpdump(1) output.
    
     /sbin/login -h "::ffff:192.168.1.7"
    
    utmpdump:
    
      [7] [03926] [1   ] [user1   ] [pts/1       ] [::ffff:192.168.1.7  ] [0.0.0.0        ] [Thu May 12 17:49:50 2016    ]
    
    Not sure if this is about order of the getaddrinfo() results, system
    configuration or libc version. It's irrelevant for login(1). We have
    to be robust enough to write usable address to log files everywhere.
    
    The solution is to detect IPv4-mapping-to-IPv6 and use IPv4 for utmp.
    
    Addresses: https://bugzilla.redhat.com/show_bug.cgi?id=1296233
    Signed-off-by: Karel Zak <kzak@redhat.com>

 login-utils/login.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)
